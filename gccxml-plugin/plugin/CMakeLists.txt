ADD_DEFINITIONS(
  -DGCCXML_PLUGIN_BASEVER=\"${GCCXML_PLUGIN_BASEVER}\"
  -DGCCXML_PLUGIN_VERSION_FULL=\"${GCCXML_PLUGIN_VERSION_FULL}\"
  )

INCLUDE_DIRECTORIES(BEFORE
  ${CMAKE_CURRENT_SOURCE_DIR}
  ${GCCXML_PLUGIN_INCLUDE_DIR}/include
  ${GCCXML_PLUGIN_INCLUDE_DIR}/include/cp
)

IF(GCCXML_INSTALL_COMPONENT_NAME_PLUGIN)
  SET(GCCXML_INSTALL_COMPONENT_PLUGIN
    COMPONENT ${GCCXML_INSTALL_COMPONENT_NAME_PLUGIN})
ENDIF(GCCXML_INSTALL_COMPONENT_NAME_PLUGIN)

#SET(GCCXML_PLUGIN_OUTPUT_PATH ${PLUGIN_OUTPUT_PATH})

# Do not inherit library building rules from the parent project.
SET(BUILD_SHARED_LIBS 1)
SET(LIBRARY_OUTPUT_PATH "${GCCXML_PLUGIN_OUTPUT_PATH}")

ADD_DEFINITIONS(-DALMOST_STDC)

SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} ${PLUGIN_FLAGS}")
SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${PLUGIN_FLAGS}")

ADD_LIBRARY(gccxml_plugin MODULE xml.c gccxml_plugin.c)
SET_TARGET_PROPERTIES(gccxml_plugin PROPERTIES
  PREFIX     ""     #< don't add 'lib' prefix.
  LINK_FLAGS "${FPIC_FLAG} ${CMAKE_SHARED_FLAGS}"
  VERSION    "${GCCXML_PLUGIN_VERSION_FULL}"
  SOVERSION  "${GCCXML_PLUGIN_VERSION_FULL}"
  )

# install in standard library directory. Better place to be?
INSTALL_TARGETS(/lib gccxml_plugin)

# GCC started writing parts of the compiler in C++, so we need to use a
# C++ compiler!
SET_SOURCE_FILES_PROPERTIES( xml.c PROPERTIES LANGUAGE CXX )

ADD_DEFINITIONS(
  -DGCCXML_PLUGIN_BASEVER=\"${GCCXML_PLUGIN_BASEVER}\"
  -DGCCXML_PLUGIN_VERSION_FULL=\"${GCCXML_PLUGIN_VERSION_FULL}\"
  )

INCLUDE_DIRECTORIES(BEFORE
  ${CMAKE_CURRENT_SOURCE_DIR}
  ${GCCXML_PLUGIN_INCLUDE_DIR}/include
  ${GCCXML_PLUGIN_INCLUDE_DIR}/include/cp
)

IF(GCCXML_INSTALL_COMPONENT_NAME_PLUGIN)
  SET(GCCXML_INSTALL_COMPONENT_PLUGIN
    COMPONENT ${GCCXML_INSTALL_COMPONENT_NAME_PLUGIN})
ENDIF(GCCXML_INSTALL_COMPONENT_NAME_PLUGIN)

#SET(GCCXML_PLUGIN_OUTPUT_PATH ${PLUGIN_OUTPUT_PATH})

# Do not inherit library building rules from the parent project.
SET(BUILD_SHARED_LIBS 1)
SET(LIBRARY_OUTPUT_PATH "${GCCXML_PLUGIN_OUTPUT_PATH}")

IF(APPLE)
  IF(CMAKE_COMPILER_IS_GNUCC)
    SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -no-cpp-precomp")
  ENDIF(CMAKE_COMPILER_IS_GNUCC)
ENDIF(APPLE)
SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} ${CMAKE_ANSI_CFLAGS}")
SET(LC_ALL "C")

IF(CMAKE_C_COMPILER MATCHES "cl")
  STRING(REGEX REPLACE "/W([0-4])?" "" CMAKE_C_FLAGS "${CMAKE_C_FLAGS}")
  SET(CMAKE_CXX_WARNING_LEVEL 0)
  SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} /W0")
ELSE(CMAKE_C_COMPILER MATCHES "cl")
  IF(CMAKE_C_COMPILER MATCHES "bcc32")
    SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -w-")
  ELSE(CMAKE_C_COMPILER MATCHES "bcc32")
    SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -w")
  ENDIF(CMAKE_C_COMPILER MATCHES "bcc32")
ENDIF(CMAKE_C_COMPILER MATCHES "cl")

ADD_DEFINITIONS(-DALMOST_STDC)

SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} ${PLUGIN_FLAGS}")
SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${PLUGIN_FLAGS}")

ADD_LIBRARY(gccxml_plugin MODULE xml.c)
SET_TARGET_PROPERTIES(gccxml_plugin PROPERTIES
  PREFIX     ""     #< don't add 'lib' prefix.
  LINK_FLAGS "${FPIC_FLAG} ${CMAKE_SHARED_FLAGS}"
  VERSION    "${GCCXML_PLUGIN_VERSION_FULL}"
  SOVERSION  "${GCCXML_PLUGIN_VERSION_FULL}"
  )

# GCC started writing parts of the compiler in C++, so we need to use a
# C++ compiler!
SET_SOURCE_FILES_PROPERTIES( xml.c PROPERTIES LANGUAGE CXX )
